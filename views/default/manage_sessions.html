{{extend 'layout.html'}}

<h2>Gestión de Sesiones Activas</h2>

{{if 'error' in response._vars:}}
<div class="alert alert-danger">
    <h4>Error</h4>
    <pre>{{=response._vars['error']}}</pre>
</div>
{{else:}}

<div class="row">
    <div class="col-md-8">
        <div class="alert alert-info">
            <strong>Tabla:</strong> {{=table_name}} | 
            <strong>Total sesiones:</strong> {{=total_sessions}} | 
            <strong>Tu sesión ID:</strong> <code>{{=current_session_id}}</code>
        </div>

        {{if not active_sessions:}}
        <div class="alert alert-warning">
            <h4>No se encontraron sesiones activas</h4>
            <p>Aunque hay registros en la tabla, no se pudieron decodificar como sesiones válidas.</p>
            <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#debugCollapse">
                Mostrar información técnica
            </button>
        </div>
        {{else:}}
        <table class="table table-bordered table-hover">
            <!-- Tabla de sesiones (como en versiones anteriores) -->
        </table>
        {{pass}}
    </div>

    <div class="col-md-4 collapse" id="debugCollapse">
        <div class="card card-body bg-light">
            <h5>Información de Diagnóstico</h5>
            <p>Primeros 5 registros analizados:</p>
            <table class="table table-sm">
                <tr>
                    <th>ID</th>
                    <th>Tamaño</th>
                    <th>Deserializado</th>
                </tr>
                {{for item in debug_info:}}
                <tr>
                    <td>{{=item['id']}}</td>
                    <td>{{=item['raw_length']}} bytes</td>
                    <td>{{='Sí' if item['deserialized'] else 'No'}}</td>
                </tr>
                {{pass}}
            </table>
            <a href="{{=URL('debug_raw_session')}}" class="btn btn-sm btn-secondary">
                Ver datos crudos
            </a>
        </div>
    </div>
</div>
{{pass}}